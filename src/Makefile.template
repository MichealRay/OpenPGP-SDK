DM_FLAGS=%DM_FLAGS%
DM_LIB=%DM_LIB%
CC=%CC%

CFLAGS=$(DM_FLAGS) -I../include %INCLUDES% %CFLAGS%
LDFLAGS=-g
LIBS=libops.a -lcrypto -lz $(DM_LIB)

all: Makefile headers .depend libops.a

LIBOBJS = packet-parse.o util.o openssl_crypto.o accumulate.o \
	memory.o fingerprint.o hash.o keyring.o signature.o compress.o \
	packet-show.o create.o validate.o lists.o armour.o errors.o \
	symmetric.o

headers:
	cd ../include/openpgpsdk && make headers

libops.a: $(LIBOBJS)
	ar rc libops.a $(LIBOBJS)

tags:
	rm -f TAGS
	find . -name '*.[ch]' | xargs etags -a

clean:
	rm -f packet-dump verify *.o *.i
	rm -f libops.a TAGS

.depend: *.[ch] ../include/openpgpsdk/*.h
	$(CC) $(CFLAGS) -E -M *.c > .depend

force_depend: headers
	$(CC) $(CFLAGS) -E -M *.c > .depend

Makefile: Makefile.template ../configure
	echo Makefile is older than templates, rerun configure.
	exit 1

include .depend
